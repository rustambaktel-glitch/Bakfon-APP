<!DOCTYPE html>
<html lang="az" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BAKFON â€“ Web Proqram</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    ::-webkit-scrollbar{width:8px;height:8px}
    ::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:8px}
    ::-webkit-scrollbar-track{background:#f1f5f9}
    .btn{ @apply px-4 py-2 rounded-lg; }
  </style>
</head>
<body id="body" class="h-full bg-slate-50 text-slate-900">
  <div id="app" class="h-full flex flex-col">
    <!-- Header -->
    <header class="relative h-16 flex items-center justify-between bg-slate-900 text-amber-400 border-b border-slate-800 px-4">
      <div class="flex items-center gap-3">
        <button id="toggle" class="md:hidden inline-flex items-center justify-center w-10 h-10 rounded-lg bg-slate-800 text-slate-200 focus:outline-none focus:ring-2 focus:ring-amber-400">â˜°</button>
        <span class="font-extrabold tracking-wider">BAKFON</span>
      </div>
      <div class="flex items-center gap-3">
        <input type="search" placeholder="Axtarâ€¦" class="hidden sm:block w-64 px-3 py-2 rounded-lg bg-slate-800 text-slate-200 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-amber-400" />
        <button id="profileBtn" class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-800 text-slate-200 hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-amber-400">
          <span class="hidden sm:inline" id="profileName">Rustam</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.186l3.71-3.955a.75.75 0 111.08 1.04l-4.25 4.53a.75.75 0 01-1.08 0l-4.25-4.53a.75.75 0 01.02-1.06z" clip-rule="evenodd"/></svg>
        </button>
        <div id="profileMenu" class="hidden absolute right-4 top-14 w-64 bg-white text-slate-800 rounded-xl border border-slate-200 shadow-lg overflow-hidden z-50">
          <div class="px-4 py-3 bg-slate-50 border-b border-slate-200">
            <p class="text-xs text-slate-500">Profil sahibi</p>
            <button id="openProfileFromMenu" class="mt-1 w-full text-left font-semibold hover:underline">Rustam Bayramov</button>
          </div>
          <button id="openSettings" class="w-full text-left px-4 py-3 hover:bg-slate-100 flex items-center gap-2">
            <span>âš™ï¸</span><span>TÉ™nzimlÉ™mÉ™lÉ™r</span>
          </button>
        </div>
      </div>
      <div id="dropdownBackdrop" class="hidden fixed inset-0 z-40"></div>
    </header>

    <!-- Content area with sidebar + main -->
    <div class="flex flex-1 min-h-0">
      <!-- Sidebar -->
      <aside id="sidebar" class="hidden md:flex md:w-64 flex-col bg-slate-900 text-slate-100 border-r border-slate-800">
        <nav class="flex-1 px-3 pb-4 pt-4 space-y-1 overflow-y-auto">
          <a href="#" id="goHome" class="group flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-800/70 transition">ğŸ  <span class="font-medium">Ana SÉ™hifÉ™</span></a>
          <a href="#" id="goKassa" class="group flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-800/70 transition">ğŸ’µ <span class="font-medium">Kassa</span></a>
          <a href="#" data-route="musteriler" class="group flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-800/70 transition">ğŸ‘¥ <span class="font-medium">MÃ¼ÅŸtÉ™rilÉ™r</span></a>
          <a href="#" data-route="anbar" class="group flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-800/70 transition">ğŸ“¦ <span class="font-medium">Anbar</span></a>
          <a href="#" data-route="hesabatlar" class="group flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-800/70 transition">ğŸ“Š <span class="font-medium">Hesabatlar</span></a>
          <a href="#" data-route="gecikmeler" class="group flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-800/70 transition">â° <span class="font-medium">GecikmÉ™lÉ™r</span></a>
          <a href="#" data-route="emekdaslar" class="group flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-800/70 transition">ğŸ‘¨â€ğŸ’¼ <span class="font-medium">ÆmÉ™kdaÅŸlar</span></a>
          <a href="#" data-route="istifadeciler" class="group flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-800/70 transition">ğŸ”‘ <span class="font-medium">Ä°stifadÉ™Ã§ilÉ™r</span></a>
        </nav>
        <div class="p-3 border-t border-slate-800 text-xs text-slate-400">
          Â© <span id="year"></span> Bakfon Electronics MMC
        </div>
      </aside>

      <!-- Main content -->
      <main id="main" class="flex-1 overflow-y-auto p-4 md:p-6 space-y-6">
        <div id="homeContent">
          <h2 class="text-xl font-bold mb-4">Ana SÉ™hifÉ™ StatistikalarÄ± ğŸ“Š</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
              <p class="text-slate-500 text-sm">BugÃ¼nkÃ¼ satÄ±ÅŸ</p>
              <h3 class="text-2xl font-bold text-slate-800">1â€¯,240 AZN</h3>
            </div>
            <div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
              <p class="text-slate-500 text-sm">Ãœmumi satÄ±ÅŸ (aylÄ±q)</p>
              <h3 class="text-2xl font-bold text-slate-800">28â€¯,560 AZN</h3>
            </div>
            <div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
              <p class="text-slate-500 text-sm">MÃ¼ÅŸtÉ™ri sayÄ±</p>
              <h3 class="text-2xl font-bold text-slate-800">312</h3>
            </div>
            <div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
              <p class="text-slate-500 text-sm">GecikmÉ™dÉ™ olanlar</p>
              <h3 class="text-2xl font-bold text-red-600">7</h3>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Settings Modal (placeholder) -->
  <div id="settingsModal" class="hidden fixed inset-0 z-50"> ... </div>

  <script>
    // --- helpers ---
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    // Ä°l
    $('#year').textContent = new Date().getFullYear();

    // Demo siyahÄ±lar (sonra API/bazadan gÉ™lÉ™ bilÉ™r)
    const CUSTOMERS = ['LemuzÉ™r RÃ¼stÉ™mova', 'Emin Quliyev', 'Aysel MÉ™mmÉ™dova'];
    const SUPPLIERS = ['TechnoTrade LLC', 'MobilePlus MMC', 'PrintStore'];

    // Demo É™mÉ™liyyatlar (tarixÃ§É™ Ã¼Ã§Ã¼n)
    const TRANSACTIONS = [
      { id: 1, date: '2025-09-15T10:30', type: 'MÉ™daxil', subType: 'NaÄŸd Ã¶dÉ™niÅŸ', party: 'Emin Quliyev', amount: 150.00, note: 'NaÄŸd kassaya' },
      { id: 2, date: '2025-09-14T16:05', type: 'MÉ™daxil', subType: 'Kredit Ã¶dÉ™niÅŸi', party: 'Aysel MÉ™mmÉ™dova', amount: 220.50, note: 'Kredit 3/12' },
      { id: 3, date: '2025-09-13T12:00', type: 'MÉ™xaric', subType: 'TÉ™chizatÃ§Ä± Ã¶dÉ™niÅŸi', party: 'TechnoTrade LLC', amount: 980.00, note: 'Faktura #TT-4521' },
      { id: 4, date: '2025-09-11T09:20', type: 'MÉ™xaric', subType: 'XÉ™rc', party: 'Kommunal', amount: 75.40, note: 'Elektrik' }
    ];

    // Ana SÉ™hifÉ™
    const main = $('#main');
    const homeContent = $('#homeContent');
    $('#goHome').addEventListener('click', (e)=>{ e.preventDefault(); main.innerHTML = homeContent.outerHTML; });

    // Kassa sÉ™hifÉ™si
    $('#goKassa').addEventListener('click', (e)=>{ e.preventDefault(); renderCashDesk(); });

    function renderCashDesk(){
      main.innerHTML = `
        <h2 class="text-xl font-bold mb-4">Kassa É™mÉ™liyyatlarÄ± ğŸ’µ</h2>
        <div class="flex flex-wrap gap-3 mb-6">
          <button id="btnYeni" class="btn bg-amber-500 text-white hover:bg-amber-600">Yeni É™mÉ™liyyat</button>
          <button id="btnTarixce" class="btn bg-slate-200 text-slate-800 hover:bg-slate-300">ÆmÉ™liyyat tarixÃ§É™si</button>
        </div>
        <div id="kassaContent" class="space-y-4"></div>
        <div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm space-y-4 mt-6">
          <h3 class="font-semibold">ÆmÉ™liyyat axtarÄ±ÅŸÄ± (tarix aralÄ±ÄŸÄ±na gÃ¶rÉ™)</h3>
          <div class="flex flex-col sm:flex-row gap-3 items-center">
            <label class="flex flex-col text-sm w-full sm:w-auto">
              BaÅŸlanÄŸÄ±c tarix
              <input id="fromDate" type="date" class="mt-1 rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400" />
            </label>
            <label class="flex flex-col text-sm w-full sm:w-auto">
              Son tarix
              <input id="toDate" type="date" class="mt-1 rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400" />
            </label>
            <button id="searchOps" class="btn bg-slate-800 text-white hover:bg-slate-700 mt-2 sm:mt-6">Axtar</button>
          </div>
          <div id="searchResult" class="text-sm text-slate-600"></div>
        </div>`;

      $('#btnYeni').addEventListener('click', renderYeniEmeliyyat);
      $('#btnTarixce').addEventListener('click', renderTarixce);

      $('#searchOps').addEventListener('click', ()=>{
        const f = $('#fromDate').value || '-';
        const t = $('#toDate').value || '-';
        $('#searchResult').textContent = `AxtarÄ±ÅŸ tÉ™tbiq olundu: ${f} â†’ ${t} (demo)`;
        // ÆgÉ™r tarixÃ§É™ aÃ§Ä±qdÄ±rsa, filter et
        if (typeof window.applyHistoryFilter === 'function') window.applyHistoryFilter();
      });

      // Default olaraq Yeni É™mÉ™liyyat aÃ§Ä±lsÄ±n
      renderYeniEmeliyyat();
    }

    function renderYeniEmeliyyat(){
      const box = $('#kassaContent');
      box.innerHTML = `
        <div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
          <h3 class="font-semibold mb-4">Yeni É™mÉ™liyyat</h3>
          <div class="inline-flex rounded-xl border border-slate-200 overflow-hidden mb-4">
            <button id="selMedaxil" class="btn bg-amber-500 text-white">MÉ™daxil</button>
            <button id="selMexaric" class="btn bg-slate-100 text-slate-800">MÉ™xaric</button>
          </div>
          <div id="opForm" class="space-y-4"></div>
        </div>`;

      // Default: MÉ™daxil formu
      renderMedaxilForm();

      $('#selMedaxil').addEventListener('click', ()=>{ toggleType(true); renderMedaxilForm(); });
      $('#selMexaric').addEventListener('click', ()=>{ toggleType(false); renderMexaricForm(); });

      function toggleType(isIncome){
        const a = $('#selMedaxil');
        const b = $('#selMexaric');
        if(isIncome){ a.className = 'btn bg-amber-500 text-white'; b.className = 'btn bg-slate-100 text-slate-800'; }
        else { a.className = 'btn bg-slate-100 text-slate-800'; b.className = 'btn bg-amber-500 text-white'; }
      }
    }

    function selectOptions(list){
      return list.map(n=>`<option value="${n}">${n}</option>`).join('');
    }

    function commonFields(){
      return `
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <label class="text-sm">MÉ™blÉ™ÄŸ (AZN)
            <input type="number" step="0.01" class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400" />
          </label>
          <label class="text-sm">Tarix
            <input type="datetime-local" class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400" />
          </label>
        </div>
        <label class="block text-sm">Qeyd
          <textarea class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400" rows="2" placeholder="QÄ±sa aÃ§Ä±qlama..."></textarea>
        </label>
        <div class="flex justify-end gap-2">
          <button class="btn border border-slate-300 hover:bg-slate-100">LÉ™ÄŸv et</button>
          <button class="btn bg-amber-500 text-white hover:bg-amber-600">Yadda saxla</button>
        </div>`;
    }

    function renderMedaxilForm(){
      const form = $('#opForm');
      form.innerHTML = `
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <label class="text-sm">KimdÉ™n (MÃ¼ÅŸtÉ™ri)
            <select class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2">${selectOptions(CUSTOMERS)}</select>
          </label>
          <label class="text-sm">ÆmÉ™liyyat nÃ¶vÃ¼
            <select id="medaxilType" class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2">
              <option>Kredit Ã¶dÉ™niÅŸi</option>
              <option>NaÄŸd Ã¶dÉ™niÅŸ</option>
            </select>
          </label>
        </div>
        <div id="medaxilExtra" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
        ${commonFields()}`;

      const extra = $('#medaxilExtra');
      function renderExtra(){
        const val = $('#medaxilType').value;
        if(val === 'Kredit Ã¶dÉ™niÅŸi'){
          extra.innerHTML = `
            <label class="text-sm">Kredit mÃ¼qavilÉ™ â„–
              <input type="text" class="mt-1 rounded-lg border border-slate-300 px-3 py-2" placeholder="MÉ™s: BT 13196" />
            </label>
            <label class="text-sm">Ã–dÉ™niÅŸ periodu
              <select class="mt-1 rounded-lg border border-slate-300 px-3 py-2">
                <option>HÉ™ftÉ™lik</option>
                <option>AylÄ±q</option>
              </select>
            </label>`;
        }else{
          extra.innerHTML = `
            <label class="text-sm">QÉ™bz â„–
              <input type="text" class="mt-1 rounded-lg border border-slate-300 px-3 py-2" placeholder="QÉ™bz nÃ¶mrÉ™si" />
            </label>
            <label class="text-sm">Ã–dÉ™niÅŸ kanalÄ±
              <select class="mt-1 rounded-lg border border-slate-300 px-3 py-2">
                <option>NaÄŸd</option>
                <option>POS</option>
                <option>Bank kÃ¶Ã§Ã¼rmÉ™</option>
              </select>
            </label>`;
        }
      }
      renderExtra();
      $('#medaxilType').addEventListener('change', renderExtra);
    }

    function renderMexaricForm(){
      const form = $('#opForm');
      form.innerHTML = `
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <label class="text-sm">KimÉ™ (TÉ™chizatÃ§Ä±)
            <select class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2">${selectOptions(SUPPLIERS)}</select>
          </label>
          <label class="text-sm">ÆmÉ™liyyat nÃ¶vÃ¼
            <select id="mexaricType" class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2">
              <option>TÉ™chizatÃ§Ä± Ã¶dÉ™niÅŸi</option>
              <option>XÉ™rc</option>
            </select>
          </label>
        </div>
        <div id="mexaricExtra" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
        ${commonFields()}`;

      const extra = $('#mexaricExtra');
      function renderExtra(){
        const val = $('#mexaricType').value;
        if(val === 'TÉ™chizatÃ§Ä± Ã¶dÉ™niÅŸi'){
          extra.innerHTML = `
            <label class="text-sm">SÉ™nÉ™d â„– / Faktura
              <input type="text" class="mt-1 rounded-lg border border-slate-300 px-3 py-2" placeholder="Faktura nÃ¶mrÉ™si" />
            </label>
            <label class="text-sm">Ã–dÉ™niÅŸ kanalÄ±
              <select class="mt-1 rounded-lg border border-slate-300 px-3 py-2">
                <option>NaÄŸd</option>
                <option>Bank kÃ¶Ã§Ã¼rmÉ™</option>
              </select>
            </label>`;
        }else{
          extra.innerHTML = `
            <label class="text-sm">XÉ™rc kateqoriyasÄ±
              <select class="mt-1 rounded-lg border border-slate-300 px-3 py-2">
                <option>Ä°carÉ™</option>
                <option>Kommunal</option>
                <option>NÉ™qliyyat</option>
                <option>DigÉ™r</option>
              </select>
            </label>
            <label class="text-sm">QÉ™bz / SÉ™nÉ™d
              <input type="text" class="mt-1 rounded-lg border border-slate-300 px-3 py-2" placeholder="QÉ™bz nÃ¶mrÉ™si" />
            </label>`;
        }
      }
      renderExtra();
      $('#mexaricType').addEventListener('change', renderExtra);
    }

    // !!! FIX: TarixÃ§É™ render funksiyasÄ± É™lavÉ™ edildi
    function renderTarixce(){
      const box = $('#kassaContent');
      box.innerHTML = `
        <div class="bg-white border border-slate-200 rounded-xl p-4 shadow-sm">
          <h3 class="font-semibold mb-4">ÆmÉ™liyyat tarixÃ§É™si</h3>
          <div class="overflow-x-auto">
            <table class="min-w-full text-sm" id="historyTable">
              <thead>
                <tr class="text-left text-slate-600">
                  <th class="py-2 pr-4">Tarix</th>
                  <th class="py-2 pr-4">Tip</th>
                  <th class="py-2 pr-4">Alt tip</th>
                  <th class="py-2 pr-4">TÉ™rÉ™f</th>
                  <th class="py-2 pr-4">MÉ™blÉ™ÄŸ</th>
                  <th class="py-2 pr-4">Qeyd</th>
                </tr>
              </thead>
              <tbody id="historyTbody" class="divide-y divide-slate-200"></tbody>
            </table>
          </div>
          <p id="emptyHistory" class="hidden text-slate-500 text-sm mt-3">MÉ™lumat yoxdur.</p>
        </div>`;

      function azn(v){ return new Intl.NumberFormat('az-AZ', { style: 'currency', currency: 'AZN' }).format(v); }
      function withinRange(d, from, to){
        const x = new Date(d).getTime();
        if (from && x < from) return false;
        if (to && x > to) return false;
        return true;
      }

      // CÉ™dvÉ™li doldur
      window.renderHistoryTable = function(data){
        const tb = $('#historyTbody');
        tb.innerHTML = '';
        if (!data || !data.length){ $('#emptyHistory').classList.remove('hidden'); return; }
        $('#emptyHistory').classList.add('hidden');
        data.forEach(r=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="py-2 pr-4">${new Date(r.date).toLocaleString('az-AZ')}</td>
            <td class="py-2 pr-4">${r.type}</td>
            <td class="py-2 pr-4">${r.subType||'-'}</td>
            <td class="py-2 pr-4">${r.party}</td>
            <td class="py-2 pr-4">${azn(r.amount)}</td>
            <td class="py-2 pr-4">${r.note||''}</td>`;
          tb.appendChild(tr);
        });
      }

      // Filter funksiyasÄ± â€“ Axtar dÃ¼ymÉ™si bunu Ã§aÄŸÄ±racaq
      window.applyHistoryFilter = function(){
        const fStr = $('#fromDate')?.value || '';
        const tStr = $('#toDate')?.value || '';
        const from = fStr ? new Date(`${fStr}T00:00:00`).getTime() : null;
        const to = tStr ? new Date(`${tStr}T23:59:59`).getTime() : null;
        const filtered = TRANSACTIONS.filter(r => withinRange(r.date, from, to));
        window.renderHistoryTable(filtered);
      }

      // Ä°lk render â€“ hamÄ±sÄ±nÄ± gÃ¶stÉ™r
      window.renderHistoryTable(TRANSACTIONS);
    }

    // --- DEV TESTS (istÉ™yÉ™ gÃ¶rÉ™ Ã§alÄ±ÅŸÄ±r) ---
    // URL-É™ ?runTests=1 É™lavÉ™ etsÉ™n, aÅŸaÄŸÄ±dakÄ± sadÉ™ testlÉ™r iÅŸÉ™ dÃ¼ÅŸÉ™cÉ™k
    (function devTests(){
      const params = new URLSearchParams(location.search);
      if (!params.get('runTests')) return; // yalnÄ±z istÉ™yÉ™ gÃ¶rÉ™
      try {
        console.assert(typeof renderCashDesk === 'function', 'renderCashDesk mÃ¶vcud deyil');
        renderCashDesk();
        console.assert(typeof renderTarixce === 'function', 'renderTarixce mÃ¶vcud deyil');
        $('#btnTarixce').click();
        console.assert($('#historyTable'), 'TarixÃ§É™ cÉ™dvÉ™li yaranmadÄ±');
        // Test: filter
        const today = new Date().toISOString().slice(0,10);
        $('#fromDate').value = today;
        $('#toDate').value = today;
        $('#searchOps').click(); // applyHistoryFilter dÉ™ Ã§aÄŸÄ±rÄ±lmalÄ±dÄ±r
        console.assert($$('#historyTbody tr').length >= 0, 'Filter iÅŸlÉ™mir');
        console.log('%cTESTS PASSED','color:green');
      } catch (e){
        console.error('TEST FAILED', e);
      }
    })();
  </script>
</body>
</html>
